# Android

## Базы данных и SQLite

Создание таблицы в SQLite

```sql
CREATE TABLE learners (
    id INTEGER PRIMARY KEY,
	name TEXT UNIQUE NOT NULL, // возможно, здесь стоит сделать индекс по имени
	phone TEXT
);
```

Даже если не определить первичный ключ, система создаст его за вас и индекс по нему. Если вы определите его сами (см код), то вы создаёте его псевдоним с указанным именем. Можно просто пользоваться встроенным id-шником.

Для передачи апострофа в строку нужно экранировать его ещё одним апострофом:

```sql
INSERT INTO artists (name,image )
VALUES ('O''Nile', 14);
```

Еще есть проблема, что можно в строку вставить число.

ID строки, который SQLite создаёт за вас, называется `rowid` и он принимает целые значения от 1.

### Функции sqlite

`ifnull()`

```sql
SELECT name, ifnull(image, '<no image>')
FROM artists;
```

`random()` - случайное целое, мб отрицательным.

`group_concat()` - конкатенация строк при `GROUP BY`.

---

В SQLite можно работать одновременно с несколькими БД. Например, соединять таблицы из двух РАЗНЫХ БД:

```sql
ATTACH DATABASE 'database2.sqlite' AS db2;
```

После этого для DML DDL операций используем префикс `db2.`. И работает.

---

В sqlite есть транзакции

```sql
BEGIN TRANSACTION;

INSERT INTO db2.images
SELECT * FROM images;

INSERT INTO db2.artists
SELECT * FROM main.artists;

END TRANSACTION;
```

Есть ROLLBACK.

---

### VACUUM

Если в файл БД добавить много данных, а потом удалить их, то размер файла не уменьшится. Для решения этой проблемы есть команда `VACUUM`. Она пересобирает базу целиком.

```sql
VACUUM;
```

Проблема в том, что в течение ее работа с БД заблокирована.

